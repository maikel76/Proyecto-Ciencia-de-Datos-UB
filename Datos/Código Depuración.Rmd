---
title: "M7 RETO 2."
output: html_document
date: "2023-05-19"
---

Los datos empleados en este trabajo provienen de "WHR-Happiness Score Dataset" y el "Índice de democracia" de la Unidad de Inteligencia de The Economist. 

El cuestionario"WHR-Happiness Score Dataset" es elaborado anualmente desde 2005 por la "World Happiness Report" y  extraído de la web Gapminder.org (con la licencia internacional Creative Commons Attribution 4.0.). El "Índice de democracia" es una clasificación hecha por la Unidad de Inteligencia de The Economist, a través de la cual se pretende determinar el rango de democracia en 167 países. 

Ya que durante el análisis exploratorio de los datos del informe "World Happiness Report" se ha encuentrado que para los países menos democráticos no hay datos suficientes se ha considerado que la alternativa más interesante es considerar otras fuentes alternativas de datos y analizar otros indicadores relacionas. Es por ello que se ha considerado interesante cruzar el "World Happiness Report" con el "Índice de democracia". Al cruzar los datos del informe internacional "World Happiness Report" de la Red de Soluciones para el Desarrollo Sostenible con los resultados del "Índice de Democracia" de la Unidad de Inteligencia de The Economist, podemos identificar una relación interesante entre la felicidad y el nivel de democracia en diferentes países.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Proyecto-Ciencia-de-Datos-UB

```{r}

## CARGAMOS BBDD ORIGINAL

# Instalar el paquete readr si no está instalado
install.packages("readr")
# Cargar el paquete tibble
library(readr)

# Cargar archivo CSV (la fusión de "WHR-Happiness Score Dataset" con el "Índice de Democracia" ya se ha realizado con el software de ofimática Open Office)
data <- read.csv("hapiscore_whr_democracy_index2022.csv")

# Visualizar los primeros registros del archivo
head(data)

```
```{r}

## FORMATEAMOS DATOS PERDIDOS

# Reemplazar valores vacíos con NA a partir de la columna 4 hasta la última
data[data == ""] <- NA

# Reemplazar los NA por la media de los valores no NA a partir de la columna 4 hasta la última
data[, 4:ncol(data)] <- t(apply(data[, 4:ncol(data)], 1, function(x) {
  nas <- is.na(x)
  if (sum(nas) > 0) {
    x[nas] <- mean(x[!nas], na.rm = TRUE)
  }
  return(x)
}))

# Visualizar los primeros registros del archivo
head(data)

```

```{r}

## CALCULAMOS MEDIA DE LOS RESULTADOS DE INDICE FELICIDAD DE CADA PAÍS (2005-2022)

# Calcular la media 
data$media <- rowMeans(data[,4:ncol(data)])

# Imprimir el dataframe resultante
print(data)

```

```{r}

## GENERAMOS EL DATA FRAME CON LOS PAÍSES Y LAS 2 VARIABLES QUE NOS INTERESAN PARA NUESTRO ANÁLISIS

# Instalar el paquete tibble y dplyr si no está instalado
install.packages("tibble")
install.packages("dplyr")

# Cargar el paquete tibble
library(tibble)
# Cargar el paquete dplyr
library(dplyr)

# Convertir a 0 los valores NA de la columna "score" (se considera que no obtener una puntuación es indicador de nula democracia, aunque puede ser un sesgo a revisar en un futuro)
data$score <- ifelse(is.na(data$score), 0, data$score)

# Crear un nuevo dataframe con el índice y las columnas 1 (país), 2 (puntuación democrática), y última columna (media puntuación felicidad)
df <- data %>%
  select(1, 2, last_col())

# Imprimir el dataframe resultante
print(df)

```

```{r}

## SUMARIZAMOS EL DATA FRAME PARA HACERNOS UNA IDEA DE LOS RESULTADOS

# Cargar el paquete dplyr
library(dplyr)

# Sumarizar el data frame
resumen <- df %>%
  summarize(
    promedio_democracia = mean(score),
    max_democracia = max(score),
    min_democracia = min(score),
    promedio_happiness = mean(media),
    max_happiness = max(media),
    min_happiness = min(media)
  )

# Imprimir el resumen
print(resumen)

```

```{r}
# GENERAMOS EL DATA FRAME FINAL CON LAS 10 PUNTUACIONES MÁS ALTAS Y LAS 10 MÁS BAJAS DE LA COLUMNA "MEAN" (media felicidad de cada país)

library(dplyr)

n <- 10  # Número de puntuaciones a seleccionar

top_scores <- df %>% top_n(n, wt = media)  # Las 10 puntuaciones más altas
bottom_scores <- df %>% top_n(-n, wt = media)  # Las 10 puntuaciones más bajas

# Combinar los resultados en un nuevo data frame
df <- rbind(top_scores, bottom_scores)

# Imprimir el df
print(df)

# Guardar el data frame como un archivo CSV
write.csv(df, "democratic-hapiness.csv", row.names = FALSE)

```
